<div id="status">Day13 - å°šæœªç™»å…¥</div>
<div id="user-info" style="display:none;">
  <h2 id="welcome"></h2>
  <p id="email"></p>
  <img id="avatar" src="" alt="å¤§é ­ç…§" style="width:80px; border-radius:50%;">
</div>

<script>
  function parseJwt(token) {
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
      return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));
    return JSON.parse(jsonPayload);
  }

  const urlParams = new URLSearchParams(window.location.search);
  const code = urlParams.get("code");

  if (code) {
    fetch("https://ducky-unique123.auth.us-east-1.amazoncognito.com/login?client_id=5ug0mo74oh6ma666kd9dkpbqk5&response_type=code&scope=email+openid+profile&redirect_uri=https://www.ducky-test.tw/index.html", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: `grant_type=authorization_code&client_id=YOUR_CLIENT_ID&code=${code}&redirect_uri=https://www.ducky-test.tw/index.html`
    })
    .then(res => res.json())
    .then(data => {
      const user = parseJwt(data.id_token);

      document.getElementById("status").innerText = "å·²ç™»å…¥";
      document.getElementById("user-info").style.display = "block";

      // é¡¯ç¤ºå€‹äººè³‡è¨Š
      document.getElementById("welcome").innerText = `å“ˆå›‰ï¼Œ${user.name || user["cognito:username"]}ï¼`;
      document.getElementById("email").innerText = `ç›®å‰ç™»å…¥å¸³è™Ÿï¼š${user.email}`;

      if (user.picture) {
        document.getElementById("avatar").src = user.picture;
      } else {
        document.getElementById("avatar").style.display = "none";
      }

      // ğŸ”¹ è·³è½‰åˆ°ä½¿ç”¨è€…å°ˆå±¬é é¢ï¼ˆä¾ username å€åˆ†ï¼‰
      window.location.href = `https://www.ducky-test.tw/${user["cognito:username"]}/index.html`;
    });
  }
</script>

